# Music Streaming API

Проект для управления музыкальным стримингом. Поддерживает работу с артистами, альбомами, треками, плейлистами и пользователями. Для безопасности используется Spring Security с Basic Authentication и ролями.

## Что есть в проекте

**Сущности:**
- `Artist` - информация об исполнителях
- `Album` - альбомы с датами релиза и обложками
- `Track` - треки с жанрами, длительностью и ссылками на аудио
- `User` - пользователи системы с username, email и ролями
- `Playlist` - пользовательские плейлисты (публичные и приватные)
- `PlaylistTrack` - связи треков с плейлистами и их позициями

**CRUD операции** для всех сущностей находятся в соответствующих контроллерах.

**Бизнес-операции:**
- Перестановка треков в плейлисте (`POST /api/playlists/{id}/tracks/move`)
- Перемешивание плейлиста (`POST /api/playlists/{id}/shuffle`)
- Клонирование плейлиста (`POST /api/playlists/{id}/clone`)
- Генерация Daily Mix (`POST /api/users/{id}/mix`)
- Статистика библиотеки пользователя (`GET /api/users/{id}/summary`)

## Установка и запуск

**Требования:**
- Java 21 или выше
- PostgreSQL 12+
- Gradle (в проекте уже есть wrapper)

**Шаги:**

1. Установить и запустить PostgreSQL:
```bash
brew install postgresql@15
brew services start postgresql@15
```

2. Создать базу данных и пользователя:
```bash
createdb musicdb || true
psql -d musicdb -c "CREATE USER freegatik WITH PASSWORD 'freegatik';" || true
psql -d musicdb -c "GRANT ALL PRIVILEGES ON DATABASE musicdb TO freegatik;"
psql -d musicdb -c "ALTER USER freegatik CREATEDB;"
```

3. При необходимости настроить переменные окружения (по умолчанию используются значения из application.properties):
```bash
export DB_URL="jdbc:postgresql://localhost:5432/musicdb"
export DB_USERNAME="freegatik"
export DB_PASSWORD="freegatik"
```

4. Запустить приложение:
```bash
# Освобождаем порт на случай если приложение уже запущено
lsof -ti:8081 | xargs kill -9 2>/dev/null || true

# Запускаем
./gradlew bootRun
```

Приложение будет доступно на `http://localhost:8081`.

## Безопасность

### Роли и доступ

В системе три типа доступа:
- **USER** - обычный пользователь, может работать только со своими плейлистами и данными
- **ADMIN** - администратор, полный доступ ко всем операциям
- Публичный доступ - просмотр артистов, альбомов, треков и публичных плейлистов без авторизации

### Что доступно без авторизации

Просмотр каталога: артисты, альбомы, треки, публичные плейлисты и регистрация новых пользователей.

### Что требует авторизации

**Только ADMIN:**
- Создание, изменение, удаление артистов, альбомов и треков
- Просмотр всех пользователей

**USER или ADMIN:**
- Создание и управление плейлистами (USER только своими)
- Просмотр и изменение своих данных (USER только своих, ADMIN - любых)

### Регистрация

Новые пользователи регистрируются через:
```
POST /api/auth/register
```

Пример запроса:
```json
{
    "username": "testuser",
    "password": "Test123!@#",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User"
}
```

Требования к паролю: минимум 8 символов, должна быть хотя бы одна цифра, одна буква и один специальный символ.

После регистрации используй Basic Auth для работы с API: username и password из запроса регистрации.

## Тестирование

Для тестирования подготовлена Postman коллекция со всеми запросами - см. `POSTMAN.md` для инструкций.

Для проверки корректности выполнения лабораторной работы используй чеклист в `CHECKLIST.md` - там перечислены все запросы и ожидаемые результаты.
