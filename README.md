# Music Streaming API

Проект для управления музыкальным стримингом. Поддерживает работу с артистами, альбомами, треками, плейлистами и пользователями. Для безопасности используется Spring Security с JWT авторизацией (Access и Refresh токены) и ролями.

## Что есть в проекте

**Сущности:**
- `Artist` - информация об исполнителях
- `Album` - альбомы с датами релиза и обложками
- `Track` - треки с жанрами, длительностью и ссылками на аудио
- `User` - пользователи системы с username, email и ролями
- `Playlist` - пользовательские плейлисты (публичные и приватные)
- `PlaylistTrack` - связи треков с плейлистами и их позициями

**CRUD операции** для всех сущностей находятся в соответствующих контроллерах.

**Бизнес-операции:**
- Перестановка треков в плейлисте (`POST /api/playlists/{id}/tracks/move`)
- Перемешивание плейлиста (`POST /api/playlists/{id}/shuffle`)
- Клонирование плейлиста (`POST /api/playlists/{id}/clone`)
- Генерация Daily Mix (`POST /api/users/{id}/mix`)
- Статистика библиотеки пользователя (`GET /api/users/{id}/summary`)

## Установка и запуск

**Требования:**
- Java 21 или выше
- PostgreSQL 12+ (должен быть установлен и запущен)
- Gradle (в проекте уже есть wrapper)

**Шаги:**

1. Убедись, что PostgreSQL установлен и запущен. База данных и пользователь настраиваются автоматически при первом запуске приложения (если их нет).

2. Запустить приложение:
```bash
# Освобождаем порт на случай если приложение уже запущено
lsof -ti:8081 | xargs kill -9 2>/dev/null || true

# Запускаем
./gradlew bootRun
```

Приложение будет доступно на `http://localhost:8081`.

## Безопасность

### Роли и доступ

В системе три типа доступа:
- **USER** - обычный пользователь, может работать только со своими плейлистами и данными
- **ADMIN** - администратор, полный доступ ко всем операциям
- Публичный доступ - просмотр артистов, альбомов, треков и публичных плейлистов без авторизации

### Что доступно без авторизации

Просмотр каталога: артисты, альбомы, треки, публичные плейлисты и регистрация новых пользователей.

### Что требует авторизации

**Только ADMIN:**
- Создание, изменение, удаление артистов, альбомов и треков
- Просмотр всех пользователей

**USER или ADMIN:**
- Создание и управление плейлистами (USER только своими)
- Просмотр и изменение своих данных (USER только своих, ADMIN - любых)

### Регистрация

Новые пользователи регистрируются через:
```
POST /api/auth/register
```

Пример запроса:
```json
{
    "username": "testuser",
    "password": "Test123!@#",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User"
}
```

Требования к паролю: минимум 8 символов, должна быть хотя бы одна цифра, одна буква и один специальный символ.

После регистрации используй Login для получения JWT токенов. Access токен используется для доступа к защищённым эндпоинтам, Refresh токен - для обновления пары токенов.

## Тестирование

Для тестирования подготовлена Postman коллекция со всеми запросами. Полная инструкция по работе с коллекцией, включая JWT авторизацию и все сценарии проверки, находится в `postman/POSTMAN.md`.
