# Инструкция по работе с Postman коллекцией

Коллекция содержит все эндпоинты API с примерами запросов и настройками Basic Auth.

## Импорт

1. Открой Postman
2. Нажми Import (Cmd+O / Ctrl+O)
3. Выбери файл `postman/music-streaming-api.postman_collection.json`
4. Коллекция появится в списке слева

## Настройка

После импорта нужно настроить переменные коллекции:

1. Кликни правой кнопкой на коллекцию "Music Streaming API" → Edit
2. Перейди на вкладку Variables
3. Заполни следующие переменные:

- `baseUrl` = `http://localhost:8081`
- `username` = твой username (заполнишь после регистрации)
- `password` = твой password (заполнишь после регистрации)
- `userId` и `playlistId` устанавливаются автоматически при выполнении запросов

## Basic Auth

Коллекция настроена так, что все запросы (кроме публичных) автоматически используют Basic Auth с переменными `{{username}}` и `{{password}}`. Если нужно изменить credentials для конкретного запроса, открой его → Authorization → Basic Auth.

## Сценарии использования

### Начало работы

1. Сначала зарегистрируйся:
   - Открой папку Authentication
   - Выполни запрос "Register User"
   - Сохрани username и password, установи их в переменных коллекции

2. После регистрации переменная `userId` установится автоматически, но лучше сразу заполнить `username` и `password` в переменных коллекции вручную.

3. Теперь можно работать с защищёнными эндпоинтами.

### Работа с плейлистами

1. "Get Public Playlists" - посмотри что есть публичного (не требует авторизации)
2. "Create Playlist" - создай свой плейлист (автоматически для тебя)
3. "Get Playlist by ID" - посмотри созданный плейлист
4. "Add Track to Playlist" - добавь треки (id треков бери из каталога)
5. "Move Track in Playlist" - переставь трек на другую позицию
6. "Shuffle Playlist" - перемешай треки
7. "Clone Playlist" - склонируй плейлист (можно клонировать публичные или свои)

### Статистика и микс

1. "Get User by ID" - посмотри свои данные (можно только свои, если не ADMIN)
2. "Get User Summary" - статистика по библиотеке (сколько плейлистов, треков, артистов)
3. "Create Daily Mix" - сгенерировать персональный микс на основе твоих плейлистов

### Административные операции

Внимание: для создания/изменения/удаления артистов, альбомов и треков нужна роль ADMIN. При регистрации создаётся USER, так что эти запросы будут возвращать 403.

Если нужен ADMIN - придётся менять роль в базе напрямую или создать отдельного пользователя с ролью ADMIN.

## Структура коллекции

Запросы разбиты по папкам:

- **Authentication** - регистрация (публичный эндпоинт)
- **Artists** - работа с артистами (GET - публичный, POST/PUT/DELETE - ADMIN)
- **Albums** - работа с альбомами (GET - публичный, POST/PUT/DELETE - ADMIN)
- **Tracks** - работа с треками (GET - публичный, POST/PUT/DELETE - ADMIN)
- **Playlists** - работа с плейлистами (нужна авторизация, USER может управлять только своими)
- **Users** - операции с пользователями (USER видит только себя, ADMIN - всех)

## Типичные ошибки

**401 Unauthorized** - неправильные username/password или не заполнены переменные `{{username}}` и `{{password}}`.

**403 Forbidden** - не хватает прав. Либо пытаешься делать ADMIN операции будучи USER, либо пытаешься изменить чужой плейлист.

**400 Bad Request** - ошибка валидации. Проверь формат данных в теле запроса.

**404 Not Found** - эндпоинт не найден или неправильный ID в пути.

## Примеры ответов

**Успешная регистрация (201):**
```json
{
    "id": 1,
    "username": "testuser",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User"
}
```

**Ошибка доступа (403):**
```json
{
    "timestamp": "2024-01-01T12:00:00",
    "status": 403,
    "error": "Доступ запрещён",
    "message": "У вас нет прав для выполнения этого действия"
}
```

## Полезные фичи

- Переменные `{{userId}}` и `{{playlistId}}` автоматически заполняются после создания пользователя/плейлиста
- Все запросы используют переменные коллекции, так что можно быстро менять базовый URL или credentials
- В коллекции есть и публичные запросы (они помечены как noauth), и защищённые (используют Basic Auth)

Если что-то не понятно - смотри примеры в запросах или запускай их по очереди, чтобы понять как работает API.
